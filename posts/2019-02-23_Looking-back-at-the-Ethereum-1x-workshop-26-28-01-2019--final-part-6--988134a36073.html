<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Looking back at the Ethereum 1x workshop 26–28.01.2019 (final part 6)</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Looking back at the Ethereum 1x workshop 26–28.01.2019 (final part 6)</h1>
</header>
<section data-field="subtitle" class="p-summary">
This is continuation of the part 1 and part 2 and part 3 and part 4 and part 5 and the final part of this series.
</section>
<section data-field="body" class="e-content">
<section name="f89f" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8d9c" id="8d9c" class="graf graf--h3 graf--leading graf--title">Looking back at the Ethereum 1x workshop 26–28.01.2019 (final part 6)</h3><p name="bc5c" id="bc5c" class="graf graf--p graf-after--h3">This is continuation of the <a href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-1-70c1ebd93266" data-href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-1-70c1ebd93266" class="markup--anchor markup--p-anchor" target="_blank">part 1</a> and <a href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-2-d3d8fdcede10" data-href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-2-d3d8fdcede10" class="markup--anchor markup--p-anchor" target="_blank">part 2</a> and <a href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-3-cc162ca04e9f" data-href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-3-cc162ca04e9f" class="markup--anchor markup--p-anchor" target="_blank">part 3</a> and <a href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-4-a69b48e14309" data-href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-4-a69b48e14309" class="markup--anchor markup--p-anchor" target="_blank">part 4</a> and <a href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-5-24ee8a9cbc40" data-href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-5-24ee8a9cbc40" class="markup--anchor markup--p-anchor" target="_blank">part 5</a> and the final part of this series.</p><h3 name="29cb" id="29cb" class="graf graf--h3 graf-after--p">Problems with large (and growing) state</h3><h4 name="8a93" id="8a93" class="graf graf--h4 graf-after--h3">Failing snapshot sync</h4><p name="fe30" id="fe30" class="graf graf--p graf-after--h4">Described in part 1</p><h4 name="abe7" id="abe7" class="graf graf--h4 graf-after--p">Duration of snapshot sync</h4><p name="8c6c" id="8c6c" class="graf graf--p graf-after--h4">Described in part 1</p><h4 name="144e" id="144e" class="graf graf--h4 graf-after--p">Slower block sealing</h4><p name="0eb4" id="0eb4" class="graf graf--p graf-after--h4">Described in part 2</p><h4 name="56b4" id="56b4" class="graf graf--h4 graf-after--p">Slower processing of transactions reading from the state</h4><p name="2c4f" id="2c4f" class="graf graf--p graf-after--h4">Described in part 3</p><h3 name="5f50" id="5f50" class="graf graf--h3 graf-after--p">Block gas limit increase and the State fees (formerly known as State rent) share initial steps</h3><p name="6f08" id="6f08" class="graf graf--p graf-after--h3">Described in part 4</p><h3 name="32b5" id="32b5" class="graf graf--h3 graf-after--p">Stateless contract pattern is discouraged by the current gas schedule</h3><p name="563c" id="563c" class="graf graf--p graf-after--h3">Described in part 5</p><h3 name="69d7" id="69d7" class="graf graf--h3 graf-after--p">eWASM interpreters could be a sensible first change even though gas cost might not be practical in the beginning</h3><p name="93ca" id="93ca" class="graf graf--p graf-after--h3">Described in part 5</p><h3 name="f149" id="f149" class="graf graf--h3 graf-after--p">Chain pruning will become more relevant as we start constraining the state growth</h3><p name="3cc6" id="3cc6" class="graf graf--p graf-after--h3">Chain pruning deals with the data that Ethereum nodes keep on the disk, other than current state and state history.</p><figure name="fd65" id="fd65" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 341px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.699999999999996%;"></div><img class="graf-image" data-image-id="1*QNB-3MIBhLa3fhlxYeIumQ.png" data-width="1920" data-height="935" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*QNB-3MIBhLa3fhlxYeIumQ.png"></div><figcaption class="imageCaption">Data transformations that happen during block execution: state + transactions =&gt; new state + receipts</figcaption></figure><p name="cd01" id="cd01" class="graf graf--p graf-after--figure">On the diagram above, we see main data transformations that happen during the block executions in Ethereum. Usually, the transactions taken from the block bodies are executed in the context of the state, and that results in the new, modified state, and also generates receipts (those receipts contain logs). This has correspondence in the yellow paper too, the relevant extract is shown at the end of this section.</p><p name="c76e" id="c76e" class="graf graf--p graf-after--p">Chain pruning is not about the “current state” (this is subject of previous parts) and “historical states” (this is currently pruned or written only sparsely already), but about block headers, block bodies (with transactions in them), and receipts (with event logs in them). Péter Szilágyi has written the first chain pruning document back in November 2018, which is <a href="https://gist.github.com/karalabe/60be7bef184c8ec286fc7ee2b35b0b5b" data-href="https://gist.github.com/karalabe/60be7bef184c8ec286fc7ee2b35b0b5b" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>. At the workshop, Fredrik Harrysson has also made presentation on the topic, where he highlighted that a better understanding of the actual requirements and possible tradeoffs is needed.</p><p name="d3bb" id="d3bb" class="graf graf--p graf-after--p">Depending on what an Ethereum node is used for, it may have different requirements to what data needs to be kept around and for how long. If the required data are missing, there are some operatives in the eth/63 protocol to fetch them from the peers:</p><ol class="postList"><li name="4bcf" id="4bcf" class="graf graf--li graf-after--p">For headers, [Get]BlockHeaders</li><li name="95de" id="95de" class="graf graf--li graf-after--li">For block bodies (with transactions in them), [Get]BlockBodies</li><li name="1741" id="1741" class="graf graf--li graf-after--li">For current and historical state, [Get]NodeData, though this does not work in Turbo-Geth and is likely to be extended once more advanced sync protocols are developed. Also, [Get]ContractCode.</li><li name="0091" id="0091" class="graf graf--li graf-after--li">For receipts, [Get]Receipts</li></ol><p name="ae60" id="ae60" class="graf graf--p graf-after--li">However, and this has also been noted in Frederik’s presentation, if peers made very diverse decisions about what data to keep around and for how long, it might take a while to find a peer that has just the information you are missing. The hope is in the new discovery protocols, like “Discovery 5”, which has been in development for few years. Regarding discovery, Antoine Toulme has made an impromptu presentation and explained some of the challenges. For example, if discovery allows you to be very “picky” about your peers, there is a risk of creating “islands” in the network, around the peers that possess certain rare information.</p><p name="0d25" id="0d25" class="graf graf--p graf-after--p">As discussed in the part 4 of this series, increased use of Stateless Contract pattern would lead to the increased size of transactions, and therefore, accelerated growth of the “block bodies” component of the chain.</p><figure name="dbdc" id="dbdc" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 305px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 43.6%;"></div><img class="graf-image" data-image-id="1*8-bFg4chqZSu1J1ReG828A.png" data-width="1041" data-height="454" src="https://cdn-images-1.medium.com/max/800/1*8-bFg4chqZSu1J1ReG828A.png"></div><figcaption class="imageCaption">State transition function from the Yellow paper</figcaption></figure><h3 name="da8a" id="da8a" class="graf graf--h3 graf-after--figure">Ethereum protocol changes do not need to take a year to be prepared</h3><p name="f15d" id="f15d" class="graf graf--p graf-after--h3">We had a brief retrospective on why the changes in the latest Ethereum upgrades, Byzantium and Constantinople, seemingly took a long time to prepare. Since we did not have a lot of core developers present, this retrospective definitely lacked some useful perspective, but I will put out here what came out of it. A lot of what is written below is my personal perspective too.</p><p name="ff84" id="ff84" class="graf graf--p graf-after--p">One apparent reason for “low change bandwidth” is the fact that there was no reason to rush. Once changes were specified and decision was made to include them, implementation of the entire Constantinople took probably couple of weeks, no more. Everyone knew approximately when the difficulty bomb would start slowing the blocks down. Other changes that were planned did not have certain deadline and there were not strictly speaking essential, more like “nice to haves”.</p><p name="ffa6" id="ffa6" class="graf graf--p graf-after--p">In Byzantium, a lot of time and effort was spent on precompiles. Fuzz tests found lots of bugs.</p><p name="707a" id="707a" class="graf graf--p graf-after--p">Third apparent reason was the fact that review of the changes happened very slowly. A lot of times people present on the Core Dev Calls were not prepared to discuss the proposed changes, so discussion had to be postponed (each time for 2 more weeks).</p><p name="d485" id="d485" class="graf graf--p graf-after--p">So what can be done to increase the “bandwidth” for Ethereum 1.x changes? Here are my ideas (would be curious to read more of them):</p><ol class="postList"><li name="f969" id="f969" class="graf graf--li graf-after--p">Only essential changes (those that need to be done ASAP based on reasonable projections, or those being on the critical path to the former) are to be proposed.</li><li name="a9bb" id="a9bb" class="graf graf--li graf-after--li">Specific precompiles are to be handled generically within the eWASM working group (meta-features vs point-features).</li><li name="9842" id="9842" class="graf graf--li graf-after--li graf--trailing">Even if we continue to use Core Dev Calls as a change review venue, most discussions should happen prior to the call. To make it work better, for each change, we should appoint a reviewer (or couple) who will either review changes themselves, or prod other reviewers to do so. It is a good idea to start growing the number of change reviewers, even from the people who are not necessarily on the calls currently, but can be invited.</li></ol></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@akhounov" class="p-author h-card">Alexey Akhunov</a> on <a href="https://medium.com/p/988134a36073"><time class="dt-published" datetime="2019-02-23T21:44:02.804Z">February 23, 2019</time></a>.</p><p><a href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-final-part-6-988134a36073" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 28, 2020.</p></footer></article></body></html>