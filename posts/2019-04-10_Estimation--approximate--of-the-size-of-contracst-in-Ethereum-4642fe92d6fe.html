<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Estimation (approximate) of the size of contracst in Ethereum</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Estimation (approximate) of the size of contracst in Ethereum</h1>
</header>
<section data-field="subtitle" class="p-summary">
As some of you may know, contracts in Ethereum have storage. Contracts write into their storage by using opcode SSTORE, and read it back…
</section>
<section data-field="body" class="e-content">
<section name="d427" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d9b7" id="d9b7" class="graf graf--h3 graf--leading graf--title">Estimation (approximate) of the size of contracts in Ethereum</h3><p name="0b49" id="0b49" class="graf graf--p graf-after--h3">As some of you may know, contracts in Ethereum have storage. Contracts write into their storage by using opcode SSTORE, and read it back using opcode SLOAD. Contract storage is modelled as a mapping, i.e. key =&gt; value. Both keys and values are 256-bit (32 bytes) values. For each contract, Ethereum tracks so called storage root, 32-byte string, which is the root of the Merkle Patricia tree, composed of those storage items “key =&gt; value”. In order to make that Markle Patricia tree more balanced, it is actually composed of items “keccak256(key) =&gt; value” and not simply “key =&gt; value”. Here, function keccak256 is used for randomisation, under the “random oracle” assumption.</p><p name="bd38" id="bd38" class="graf graf--p graf-after--p">Unfortunately, Ethereum does not track the size of the contract storage for each contract. This would be useful for at least two things:</p><ol class="postList"><li name="51ca" id="51ca" class="graf graf--li graf-after--p">Advanced snapshot sync protocols (need for such protocols described <a href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-1-70c1ebd93266" data-href="https://medium.com/@akhounov/looking-back-at-the-ethereum-1x-workshop-26-28-01-2019-part-1-70c1ebd93266" class="markup--anchor markup--li-anchor" target="_blank">here</a>)</li><li name="0f90" id="0f90" class="graf graf--li graf-after--li">Storage rent prepayment as a part of State Fees (rent)</li></ol><p name="0b90" id="0b90" class="graf graf--p graf-after--li">Here I will mostly be taking about (2). In the latest published <a href="https://github.com/ledgerwatch/eth_state/blob/master/State_Fees_3.pdf" data-href="https://github.com/ledgerwatch/eth_state/blob/master/State_Fees_3.pdf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">State Fees proposal</a>, there is a mechanism for charging contract storage rent prepayments, that relies on the knowledge of the contract storage size:</p><figure name="3085" id="3085" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 396px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.599999999999994%;"></div><img class="graf-image" data-image-id="1*TMuR16P_8Y67gRuxQ1o-Rw.png" data-width="1938" data-height="1096" src="https://cdn-images-1.medium.com/max/800/1*TMuR16P_8Y67gRuxQ1o-Rw.png"></div><figcaption class="imageCaption">Page 37 of the State Fees proposal (version 3)</figcaption></figure><p name="e67e" id="e67e" class="graf graf--p graf-after--figure">Depending on the relation between <em class="markup--em markup--p-em">rentbalance</em> and <em class="markup--em markup--p-em">storagesize</em>, storage prepayment is either charged or not in the case of SSTORE modifying an existing storage item (orange circle). This measure is designed to preclude hoarding of the contract storage ahead of the hard fork that makes SSTORE more expensive.</p><p name="0dd8" id="0dd8" class="graf graf--p graf-after--p">On the other hand, change J is believed to be a pre-requisite for the safe lifting of the block gas limit:</p><figure name="13fc" id="13fc" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 386px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 55.1%;"></div><img class="graf-image" data-image-id="1*-u6pXyaFlBhHcfoDQB9XPA.png" data-width="2059" data-height="1135" src="https://cdn-images-1.medium.com/max/800/1*-u6pXyaFlBhHcfoDQB9XPA.png"></div><figcaption class="imageCaption">Page 8 of the State Fees proposal (version 3)</figcaption></figure><figure name="002f" id="002f" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 284px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 40.6%;"></div><img class="graf-image" data-image-id="1*sDSlZwCco8cmtjBCTPvmUg.png" data-width="1978" data-height="803" src="https://cdn-images-1.medium.com/max/800/1*sDSlZwCco8cmtjBCTPvmUg.png"></div><figcaption class="imageCaption">Page 9 of the State Fees proposal (version 3)</figcaption></figure><p name="b1bf" id="b1bf" class="graf graf--p graf-after--figure">The fact that Ethereum does not currently track the storage sizes of contract, means that the storage rent prepayments (and safe block gas limit increase) were slated for the second hard fork (safe introduction of the accurate contract storage sizes requires two hard forks).</p><p name="4ff9" id="4ff9" class="graf graf--p graf-after--p">However, if there was a way to estimate the contract sizes approximately, and if we agreed that these were still useful to decide on the prepayments, we could bring the change J forward into the 1st hard fork:</p><figure name="871a" id="871a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 393px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.2%;"></div><img class="graf-image" data-image-id="1*CBTeZb3QlaKHSc4jtwB9Pg.png" data-width="2049" data-height="1151" src="https://cdn-images-1.medium.com/max/800/1*CBTeZb3QlaKHSc4jtwB9Pg.png"></div><figcaption class="imageCaption">Modified timeline that brings block gas limit increase closer?</figcaption></figure><p name="6737" id="6737" class="graf graf--p graf-after--figure">Now, how could this estimation work?</p><p name="78a0" id="78a0" class="graf graf--p graf-after--p">Since keccak256 is assumed to be randomising, for n storage keys key_1, key_2, …, key_n, the distribution of keccak256(key_1), keccak256(key_2), …, keccak256(key_n) would be quite uniform in the range of numbers 0..2²⁵⁶-1. Therefore, on average, the distance between two subsequent key hashes, would be <em class="markup--em markup--p-em">2²⁵⁶/n</em>. We can reverse the problem, and try to estimate the average distance between two subsequent key hashes, let’s say, <em class="markup--em markup--p-em">avg_diff</em>, and then estimate <em class="markup--em markup--p-em">n</em> as <em class="markup--em markup--p-em">2²⁵⁶/avg_diff</em>. One can show this more rigorously, based on modelling the sequence of key hashes as a Poisson process, then realising that the difference between two events would follow an exponential distribution, and, finally, deriving the maximum likelihood estimator for <em class="markup--em markup--p-em">n</em>, which basically tells us to estimate <em class="markup--em markup--p-em">n</em> as <em class="markup--em markup--p-em">2²⁵⁶/avg_diff</em>.</p><p name="8b60" id="8b60" class="graf graf--p graf-after--p">In order to see how accurate such estimates would be, I chose one particular method for estimating <em class="markup--em markup--p-em">avg_diff</em>. Most probably, another, simpler and better method can be found, and I hope for someone to help me do it.</p><figure name="de1a" id="de1a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 556px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 79.5%;"></div><img class="graf-image" data-image-id="1*ElAPitT-KEP3czaxF5E6IA.png" data-width="1355" data-height="1077" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*ElAPitT-KEP3czaxF5E6IA.png"></div></figure><p name="ca39" id="ca39" class="graf graf--p graf-after--figure">We represent the range 0..2²⁵⁶-1 as a circle (we wrap the range so that 0 equals 2²⁵⁶), and generate certain number of equidistant numbers, called “probes”. In the illustration above, there are 5 probes, shown as green rays. The first probe is chosen using some pseudo-random number. For example, we can take the storage root for that purpose. For each probe, we look for the first keyhash (blue ray) equal or after the probe, and then a certain number of subsequent keyhashes (also blue rays) after that (in the illustration, this number is 2). It is likely that in the implementations of Ethereum, finding the keyhash next to the probe is more expensive operation than finding the next keyhash after a known one.</p><p name="0004" id="0004" class="graf graf--p graf-after--p">As a result of this “probing”, we have number of samples. In this illustration above, there are 5x2 = 10 samples. Out of these samples, we calculate <em class="markup--em markup--p-em">avg_diff</em> as a simple average.</p><h3 name="4ac1" id="4ac1" class="graf graf--h3 graf-after--p">Experimental results</h3><p name="bd11" id="bd11" class="graf graf--p graf-after--h3">I have taken the state of Ethereum main net at block 7293802 (March 3rd 2019), and analysed all contracts and their storage. As suggested before, the storage root was used as a seed to choose the first probe. The number of probes varied from 1 to 19, and number of items explored after each probe varied from 1 to 49 (there were 931 estimations done for each contract). For each estimation, the relative error was computed in percentages of the actual storage size. Maximum of the relative errors over all the contracts were gathered in this heatmap table (rows are number of probes, columns are number of items explored after each probe):</p><figure name="0389" id="0389" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*u5GapweKGkuxOykkIPywPA.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*u5GapweKGkuxOykkIPywPA.png"></div><figcaption class="imageCaption">Relative estimation errors for all contracts</figcaption></figure><p name="c1de" id="c1de" class="graf graf--p graf-after--figure">In order to make better sense of this result, similar heatmap tables were calculated for groups of contracts depending on their storage size:</p><figure name="2ddc" id="2ddc" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*SVT3Yl5pnyYnDGEeyDprFQ.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*SVT3Yl5pnyYnDGEeyDprFQ.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 2 to 3</figcaption></figure><figure name="3958" id="3958" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*XyI6IPiv2HVqCYLGlmtm-A.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*XyI6IPiv2HVqCYLGlmtm-A.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 4 to 7</figcaption></figure><figure name="4f14" id="4f14" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*7Zeswgu8_GFHuoI1I-lGvQ.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*7Zeswgu8_GFHuoI1I-lGvQ.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 8 to 15</figcaption></figure><figure name="7bfe" id="7bfe" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*ndqW8TETl4qVPNbzeTdiMg.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*ndqW8TETl4qVPNbzeTdiMg.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 16 to 31</figcaption></figure><figure name="6b66" id="6b66" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*BjcXeeY2bqWw3H01A7JvYg.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*BjcXeeY2bqWw3H01A7JvYg.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 32 to 63</figcaption></figure><figure name="86e8" id="86e8" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*6L-CPMjERDVX23VUMv1jeA.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*6L-CPMjERDVX23VUMv1jeA.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 64 to 127</figcaption></figure><figure name="7ff3" id="7ff3" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*GVDnGvggc-fpw12QxuJBoA.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*GVDnGvggc-fpw12QxuJBoA.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 128 to 255</figcaption></figure><figure name="ef81" id="ef81" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*hbCL-BIiSd7E1qU-DdsSlw.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*hbCL-BIiSd7E1qU-DdsSlw.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 256 to 511</figcaption></figure><figure name="6c7e" id="6c7e" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*J9NsOliqKY6__40-jNgm8g.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*J9NsOliqKY6__40-jNgm8g.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 512 to 1&#39;023</figcaption></figure><figure name="94c4" id="94c4" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*FxA-Vvh6hqRaP1GyTDMavw.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*FxA-Vvh6hqRaP1GyTDMavw.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 1&#39;024 to 2&#39;047</figcaption></figure><figure name="d3f7" id="d3f7" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*lsvuryBjdaXwNZQx8yuyEg.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*lsvuryBjdaXwNZQx8yuyEg.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 2&#39;048 to 4&#39;095</figcaption></figure><figure name="592e" id="592e" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*e9IQdV6_XP7qyzn3z841Lg.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*e9IQdV6_XP7qyzn3z841Lg.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 4&#39;096 to 8&#39;191</figcaption></figure><figure name="3c32" id="3c32" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*ORs8Ia3VIB1JxUlYoXH5zg.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*ORs8Ia3VIB1JxUlYoXH5zg.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 8&#39;192 to 16&#39;383</figcaption></figure><figure name="56e3" id="56e3" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*FNOONFjOaLX1iMCf3zPGUg.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*FNOONFjOaLX1iMCf3zPGUg.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 16&#39;384 to 32&#39;767</figcaption></figure><figure name="2f1a" id="2f1a" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*7lZRkUtCM2u4KiBIXROnTw.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*7lZRkUtCM2u4KiBIXROnTw.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 32&#39;768 to 65&#39;535</figcaption></figure><figure name="ed01" id="ed01" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*3qZMGxekmQFX34jcAYEgyw.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*3qZMGxekmQFX34jcAYEgyw.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 65&#39;536 to 131&#39;071</figcaption></figure><figure name="e334" id="e334" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*IwuIiVge0YQpGgnNpsqKZw.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*IwuIiVge0YQpGgnNpsqKZw.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 131&#39;072 to 262&#39;143</figcaption></figure><figure name="7b52" id="7b52" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*dqT8CMTjmXWQBxGB_KKcOA.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*dqT8CMTjmXWQBxGB_KKcOA.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 262&#39;144 to 524&#39;287</figcaption></figure><figure name="3d8a" id="3d8a" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*HG4aPcMzQ6NMYRTEIY9cHg.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*HG4aPcMzQ6NMYRTEIY9cHg.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 524&#39;288 to 1&#39;048&#39;575</figcaption></figure><figure name="bc1e" id="bc1e" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*rmRAWjH8qsssMoSE1e37bA.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*rmRAWjH8qsssMoSE1e37bA.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 1&#39;048&#39;576 to 2&#39;097&#39;151</figcaption></figure><figure name="33e2" id="33e2" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*NZjQ-X-ofkw1fKIaQBQIVA.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*NZjQ-X-ofkw1fKIaQBQIVA.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 2&#39;097&#39;152 to 4&#39;194&#39;303</figcaption></figure><figure name="8ca3" id="8ca3" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 168px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24%;"></div><img class="graf-image" data-image-id="1*Cr3PpVTrDmRSO_p1BOTKfw.png" data-width="2000" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*Cr3PpVTrDmRSO_p1BOTKfw.png"></div><figcaption class="imageCaption">Relative estimation errors for contracts with storage size from 4&#39;194&#39;304</figcaption></figure><h3 name="d327" id="d327" class="graf graf--h3 graf-after--figure">Next steps</h3><p name="e7e8" id="e7e8" class="graf graf--p graf-after--h3 graf--trailing">Using the very first heap map table, we may choose some “nice” values for the number of probes and the number of items explored after each probe, and measure concrete performance of such probing on some implementations. For example, we can pick 8 probes and 32 items explored after each probe, which would give us relative error of 24.5%. If we are happy with this error for our purposes, we can see how complex the implementation of an estimator would be as a protocol change. Before we do that, I would like to get some feedback on the general idea of this kind of estimation.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@akhounov" class="p-author h-card">Alexey Akhunov</a> on <a href="https://medium.com/p/4642fe92d6fe"><time class="dt-published" datetime="2019-04-10T16:02:51.826Z">April 10, 2019</time></a>.</p><p><a href="https://medium.com/@akhounov/estimation-approximate-of-the-size-of-contracst-in-ethereum-4642fe92d6fe" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 28, 2020.</p></footer></article></body></html>